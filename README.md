# Connections

A web-based word puzzle game inspired by the NY Times Connections, where players identify groups of four words that share a hidden connection. Built with React + TypeScript and Flask, with an AI-powered puzzle generation pipeline.

## Features

- **AI-Generated Puzzles**: Puzzles are generated by Claude (Anthropic) and drawn from a pre-built pool hosted in Supabase
- **Authentication & Guest Mode**: Sign in with Supabase Auth or play immediately as a guest
- **Animated Guessing**: Multi-phase animations on submission — nudge, swap, and fade — give clear visual feedback
- **Win/Loss Screen**: A results modal shows your guess history and auto-reveals unsolved categories on loss
- **Responsive Design**: Adapts to various screen sizes

## Tech Stack

| Layer | Tech |
|---|---|
| Frontend | React 18 + TypeScript + Vite |
| Styling | SCSS + Bootstrap 5 + react-bootstrap |
| Auth | Supabase JS client |
| Backend | Python + Flask |
| Database | Supabase (PostgreSQL) — game sessions + puzzle pool |
| Puzzle Generation | Claude (Anthropic API) |

## Project Structure

```
Connections/
├── backend/        # Flask API, game logic, puzzle generation pipeline
├── frontend/       # React/TypeScript UI
└── docs/           # Architecture diagrams, API reference
```

## Getting Started

### Prerequisites

- Python 3.10+
- Node.js 18+ and npm
- A Supabase project (for auth and puzzle pool)
- An Anthropic API key (for puzzle generation)

### 1. Clone the repo

```bash
git clone https://github.com/chrooks/Connections.git
cd Connections
```

### 2. Set up the backend

```bash
cd backend
python3 -m venv .venv
source .venv/bin/activate       # On Windows: .venv\Scripts\activate
pip install uv                  # Fast dependency installer (one-time)
uv pip install -r requirements.txt
```

Copy the environment template and fill in your values:

```bash
cp .env.example .env
# Edit .env with your Supabase URL, Supabase service key, and Anthropic API key
```

Start the Flask server:

```bash
python -m src.app
```

The backend runs at `http://localhost:5000`.

### 3. Set up the frontend

```bash
cd ../frontend
npm install
```

Copy the environment template and fill in your values:

```bash
cp .env.example .env
# Edit .env with your Supabase URL and anon key
```

Start the dev server:

```bash
npm run dev
```

The frontend runs at `http://localhost:5173`.

## Playing the Game

1. Open `http://localhost:5173` in your browser
2. Sign in or continue as a guest
3. You'll see a 4×4 grid of words — select four you think share a connection and submit
4. A correct guess reveals the category; an incorrect one costs a mistake (you have 4)
5. Win by finding all four groups, or see the reveal on a loss

## Architecture Notes

### Supabase for Everything

All persistent state lives in Supabase PostgreSQL:

- **`game_sessions` table**: Stores active and completed games — the word grid, connections, guess history, mistakes remaining, win/loss status, and an optional link to the player's Supabase user account. Guest games have a `NULL` `user_id`.
- **Puzzle pool tables** (`puzzles`, `puzzle_groups`, `puzzle_words`): Pre-generated, approved puzzles served on game start. Each `game_sessions` row links back to the `puzzles` row it was drawn from via `puzzle_id`, enabling per-puzzle analytics (completion rate, average mistakes, etc.).

Because game state is in the cloud, sessions survive server restarts and are linked to authenticated users, making per-user history and stats possible in the future.

### Puzzle Generation Pipeline

Puzzles are generated offline by `group_generator.py`, which calls Claude via the Anthropic API and uses structured tool output to produce candidate word groups. Generated puzzles go through an approval step in Supabase before entering the pool. The pipeline is designed so generation and validation happen separately from the game serving path.

### API Endpoints

| Method | Path | Purpose |
|---|---|---|
| GET | `/connections/generate-grid` | Start a new game (pool-first, then fallback) |
| POST | `/connections/submit-guess` | Submit a 4-word guess |
| POST | `/connections/game-status` | Fetch current game state |
| POST | `/connections/restart-game` | Reset with a new grid |

See [docs/API.md](docs/API.md) for full request/response details.

## Testing

```bash
# From the backend directory
cd backend
source .venv/bin/activate
pytest
```

Tests cover game logic, the data access layer, API endpoints, puzzle generation, and the puzzle pool service.

## Contributing

Pull requests and issues are welcome. Please make sure both servers run cleanly and tests pass before submitting.

## License

MIT License — see [LICENSE](LICENSE) for details.
